[2022-06-08 12:43:57,717] {taskinstance.py:1159} INFO - Dependencies all met for <TaskInstance: spotify_dag.Whole_Spotify_ETL scheduled__2022-06-08T05:44:00+00:00 [queued]>
[2022-06-08 12:43:57,727] {taskinstance.py:1159} INFO - Dependencies all met for <TaskInstance: spotify_dag.Whole_Spotify_ETL scheduled__2022-06-08T05:44:00+00:00 [queued]>
[2022-06-08 12:43:57,728] {taskinstance.py:1356} INFO - 
--------------------------------------------------------------------------------
[2022-06-08 12:43:57,728] {taskinstance.py:1357} INFO - Starting attempt 1 of 2
[2022-06-08 12:43:57,728] {taskinstance.py:1358} INFO - 
--------------------------------------------------------------------------------
[2022-06-08 12:43:57,746] {taskinstance.py:1377} INFO - Executing <Task(PythonOperator): Whole_Spotify_ETL> on 2022-06-08 05:44:00+00:00
[2022-06-08 12:43:57,750] {standard_task_runner.py:52} INFO - Started process 117699 to run task
[2022-06-08 12:43:57,756] {standard_task_runner.py:79} INFO - Running: ['airflow', 'tasks', 'run', 'spotify_dag', 'Whole_Spotify_ETL', 'scheduled__2022-06-08T05:44:00+00:00', '--job-id', '403', '--raw', '--subdir', 'DAGS_FOLDER/spotify_dag.py', '--cfg-path', '/tmp/tmpneghl2vd', '--error-file', '/tmp/tmpvo9i7mll']
[2022-06-08 12:43:57,757] {standard_task_runner.py:80} INFO - Job 403: Subtask Whole_Spotify_ETL
[2022-06-08 12:44:03,188] {task_command.py:370} INFO - Running <TaskInstance: spotify_dag.Whole_Spotify_ETL scheduled__2022-06-08T05:44:00+00:00 [running]> on host kubernetes-worker
[2022-06-08 12:44:13,219] {base_job.py:229} ERROR - LocalTaskJob heartbeat got an exception
Traceback (most recent call last):
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1705, in _execute_context
    self.dialect.do_execute(
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 716, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/james/airflowa/lib/python3.8/site-packages/airflow/jobs/base_job.py", line 201, in heartbeat
    session.merge(self)
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 2872, in merge
    return self._merge(
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 2950, in _merge
    merged = self.get(mapper.class_, key[1], identity_token=key[2])
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 2695, in get
    return self._get_impl(
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 2796, in _get_impl
    return db_load_fn(
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/orm/loading.py", line 531, in load_on_pk_identity
    session.execute(
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1670, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1520, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 313, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1389, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1748, in _execute_context
    self._handle_dbapi_exception(
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1929, in _handle_dbapi_exception
    util.raise_(
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1705, in _execute_context
    self.dialect.do_execute(
  File "/home/james/airflowa/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 716, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) database is locked
[SQL: SELECT job.id AS job_id, job.dag_id AS job_dag_id, job.state AS job_state, job.job_type AS job_job_type, job.start_date AS job_start_date, job.end_date AS job_end_date, job.latest_heartbeat AS job_latest_heartbeat, job.executor_class AS job_executor_class, job.hostname AS job_hostname, job.unixname AS job_unixname 
FROM job 
WHERE job.id = ? AND job.job_type IN (?)]
[parameters: (403, 'LocalTaskJob')]
(Background on this error at: http://sqlalche.me/e/14/e3q8)
[2022-06-08 12:44:14,442] {taskinstance.py:1569} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_EMAIL=wabuyajames@gmail.com
AIRFLOW_CTX_DAG_OWNER=airflow
AIRFLOW_CTX_DAG_ID=spotify_dag
AIRFLOW_CTX_TASK_ID=Whole_Spotify_ETL
AIRFLOW_CTX_EXECUTION_DATE=2022-06-08T05:44:00+00:00
AIRFLOW_CTX_TRY_NUMBER=1
AIRFLOW_CTX_DAG_RUN_ID=scheduled__2022-06-08T05:44:00+00:00
[2022-06-08 12:44:14,444] {taskinstance.py:1889} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/james/airflowa/lib/python3.8/site-packages/airflow/operators/python.py", line 171, in execute
    return_value = self.execute_callable()
  File "/home/james/airflowa/lib/python3.8/site-packages/airflow/operators/python.py", line 189, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/home/james/airflow/dags/spotify_etl.py", line 49, in run_spotify_etl
    today = datetime.datetime.now()
AttributeError: type object 'datetime.datetime' has no attribute 'datetime'
[2022-06-08 12:44:14,461] {taskinstance.py:1395} INFO - Marking task as UP_FOR_RETRY. dag_id=spotify_dag, task_id=Whole_Spotify_ETL, execution_date=20220608T054400, start_date=20220608T094357, end_date=20220608T094414
[2022-06-08 12:44:14,523] {standard_task_runner.py:92} ERROR - Failed to execute job 403 for task Whole_Spotify_ETL (type object 'datetime.datetime' has no attribute 'datetime'; 117699)
[2022-06-08 12:44:14,566] {local_task_job.py:156} INFO - Task exited with return code 1
[2022-06-08 12:44:14,605] {local_task_job.py:273} INFO - 0 downstream tasks scheduled from follow-on schedule check
